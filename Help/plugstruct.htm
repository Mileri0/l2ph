<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Структура плагина (обязательные элементы)</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">

</head>

<BODY>
<P><FONT face=Arial size=2>&nbsp;&nbsp;<FONT size=2><FONT 
face=Arial>&nbsp;</FONT><FONT size=5><FONT face=Arial 
color=#003f7d><STRONG>Плагины. Структура плагина.</STRONG></FONT><FONT 
size=3><FONT color=#003f7d> </FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial>
<P>
<P>
<P>
<HR>
</FONT></FONT></FONT></FONT></FONT>
<P><STRONG><FONT size=2>Для версии 3.5.2.102</FONT></STRONG></P>
<P><STRONG>Структура плагина, ОБЯЗАТЕЛЬНАЯ.</STRONG></P>
<P>
<TABLE style="BORDER-COLLAPSE: collapse" borderColor=#000000 cellSpacing=0 
cellPadding=2 width="100%" border=1>
  <TBODY>
  <TR>
    <TD>
      <P>&nbsp;<FONT size=2><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">uses</SPAN><BR>&nbsp; 
      FastMM4 <SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> 
      <SPAN style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4.pas'</SPAN>, <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//Должен идти 
      первым.</SPAN><BR>&nbsp; FastMM4Messages <SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> <SPAN 
      style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4Messages.pas'</SPAN>,<BR>&nbsp;&nbsp;windows,<BR>&nbsp;&nbsp;&nbsp; 
      <SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// модуль с 
      описаниями основных типов</SPAN><BR>&nbsp; &nbsp; <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// используемых в плагине 
      и программе</SPAN><BR>&nbsp; usharedstructs <SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> <SPAN 
      style="COLOR: rgb(0,0,240)">'..\units\usharedstructs.pas'</SPAN>;<BR><BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">var</SPAN>&nbsp; &nbsp; 
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
      &nbsp; &nbsp; &nbsp; &nbsp; <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{version}</SPAN> <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{revision}</SPAN><BR>&nbsp; 
      min_ver_a: array[<SPAN style="COLOR: rgb(0,0,240)">0</SPAN>..<SPAN 
      style="COLOR: rgb(0,0,240)">3</SPAN>] <SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">of</SPAN> <SPAN 
      style="COLOR: rgb(0,0,0)">Byte</SPAN> = <SPAN 
      style="COLOR: rgb(0,0,0)">(</SPAN> <SPAN 
      style="COLOR: rgb(0,0,240)">3</SPAN>,<SPAN 
      style="COLOR: rgb(0,0,240)">5</SPAN>,<SPAN 
      style="COLOR: rgb(0,0,240)">1</SPAN>,&nbsp; &nbsp; &nbsp; <SPAN 
      style="COLOR: rgb(0,0,240)">98</SPAN>&nbsp; &nbsp;<SPAN 
      style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; min_ver: <SPAN 
      style="COLOR: rgb(0,0,0)">Integer</SPAN> absolute min_ver_a; <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// минимальная 
      поддерживаемая версия программы</SPAN><BR>&nbsp; ps: TPluginStruct; <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// структура передаваемая 
      в плагин</SPAN><BR><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Обязательно вызываемая 
      функция.</SPAN><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Должна вернуть описание 
      плагина,</SPAN><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// заодно может проверить 
      версию программы</SPAN><BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">function</SPAN> 
      GetPluginInfo<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> ver: <SPAN 
      style="COLOR: rgb(0,0,0)">Integer</SPAN><SPAN 
      style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
      style="COLOR: rgb(0,0,0)">PChar</SPAN>; stdcall;<BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; 
      <SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">if</SPAN> 
      ver&lt;min_ver <SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">then</SPAN><BR>&nbsp; 
      &nbsp; Result:=<SPAN style="COLOR: rgb(0,0,240)">'Демонстрационный Plugin 
      к программе l2phx'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; 
      &nbsp; &nbsp; <SPAN style="COLOR: rgb(0,0,240)">'Для версий 
      3.5.1.98+'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
      <SPAN style="COLOR: rgb(0,0,240)">'У вас старая версия программы! Плагин 
      не сможет корректно с ней работать!'</SPAN><BR>&nbsp; <SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">else</SPAN><BR>&nbsp; 
      &nbsp; Result:=<SPAN style="COLOR: rgb(0,0,240)">'Демонстрационный Plugin 
      к программе l2phx'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; 
      &nbsp; &nbsp; <SPAN style="COLOR: rgb(0,0,240)">'Для версий 
      3.5.1.98+'</SPAN>;<BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Обязательно вызываемая 
      функция.</SPAN><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Получает структуру с 
      ссылками на все функции основной программы,</SPAN><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// которые могут 
      вызываться из плагина.</SPAN><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Если вернёт False то 
      плагин выгружается.</SPAN><BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">function</SPAN> 
      SetStruct<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> struct: 
      PPluginStruct<SPAN style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
      style="COLOR: rgb(0,0,0)">Boolean</SPAN>; stdcall;<BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; ps 
      := TPluginStruct<SPAN style="COLOR: rgb(0,0,0)">(</SPAN>struct^<SPAN 
      style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; Result:=<SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">True</SPAN>;<BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// экспортируем 
      используемые программой функции</SPAN><BR>exports<BR>&nbsp; 
      GetPluginInfo,<BR>&nbsp; SetStruct;<BR>&nbsp; <SPAN 
      style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//Остальные не 
      обязательны, и используютсся по желанию.</SPAN><BR>&nbsp; </FONT><FONT 
      size=2><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{<BR>&nbsp; 
      OnPacket,<BR>&nbsp; OnConnect,<BR>&nbsp; OnDisconnect,<BR>&nbsp; 
      OnLoad,<BR>&nbsp; OnFree,<BR>&nbsp; OnCallMethod,<BR>&nbsp; 
      OnRefreshPrecompile;<BR>&nbsp; }</SPAN><BR><BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><SPAN 
      style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>.<FONT 
      color=#004a95><STRONG></P></STRONG></FONT></FONT></TD></TR></TBODY></TABLE></P>
<P><STRONG></STRONG>&nbsp;</P>
<P>Класс&nbsp;TPluginStruct экземпляр которого передается плагину можно глянуть 
в разделе "Содержимое uSharedStructs"<BR>Все&nbsp;ее&nbsp;функции/процедуры в 
ней аналогичны тем что используются в скриптах.</P></BODY>
</html>
