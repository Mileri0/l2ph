<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Структура плагина (обязательные элементы)</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">

</head>

<BODY>
<P><FONT size=2 face=Arial>&nbsp;&nbsp;<FONT size=2><FONT 
face=Arial>&nbsp;</FONT><FONT size=5><FONT color=#003f7d 
face=Arial><STRONG>Плагины. Структура плагина.</STRONG></FONT><FONT size=3><FONT 
color=#003f7d> </FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial>
<P>
<P>
<P>
<HR>
</FONT></FONT></FONT></FONT></FONT>
<P><STRONG>Структура плагина, ОБЯЗАТЕЛЬНАЯ.</STRONG></P>library 
plugin_demo3;<BR><BR><FONT size=2><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">uses</SPAN><BR>&nbsp; FastMM4 
<SPAN style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">in</SPAN> <SPAN 
style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4.pas'</SPAN>,<BR>&nbsp; 
FastMM4Messages <SPAN style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">in</SPAN> 
<SPAN 
style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4Messages.pas'</SPAN>,<BR>&nbsp; 
windows,&nbsp; <BR>&nbsp; usharedstructs <SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">in</SPAN> <SPAN 
style="COLOR: rgb(0,0,240)">'..\units\usharedstructs.pas'</SPAN>,<BR>&nbsp; 
plugin_demo3_form <SPAN style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">in</SPAN> 
<SPAN style="COLOR: rgb(0,0,240)">'plugin_demo3_form.pas'</SPAN> <SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">{MyForm}</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">var</SPAN><BR>&nbsp; min_ver_a: 
array[<SPAN style="COLOR: rgb(0,0,240)">0</SPAN>..<SPAN 
style="COLOR: rgb(0,0,240)">3</SPAN>] <SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">of</SPAN> <SPAN 
style="COLOR: rgb(0,0,0)">Byte</SPAN> = <SPAN style="COLOR: rgb(0,0,0)">(</SPAN> 
<SPAN style="COLOR: rgb(0,0,240)">3</SPAN>,<SPAN 
style="COLOR: rgb(0,0,240)">5</SPAN>,<SPAN 
style="COLOR: rgb(0,0,240)">23</SPAN>,&nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,0,240)">141</SPAN>&nbsp; &nbsp;<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; min_ver: <SPAN 
style="COLOR: rgb(0,0,0)">LongWord</SPAN> absolute min_ver_a; <SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// минимальная поддерживаемая 
версия программы</SPAN><BR>&nbsp; ps: TPluginStruct; <SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// структура передаваемая в 
плагин</SPAN><BR><BR><SPAN style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// 
Обязательно вызываемая функция.</SPAN><BR><SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// Должна вернуть описание 
плагина,</SPAN><BR><SPAN style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// 
заодно может проверить версию программы</SPAN><BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">function</SPAN> 
GetPluginInfo<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">const</SPAN> ver: <SPAN 
style="COLOR: rgb(0,0,0)">LongWord</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
style="COLOR: rgb(0,0,0)">PChar</SPAN>; stdcall;<BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">begin</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">if</SPAN> ver&lt;min_ver <SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">then</SPAN><BR>&nbsp; &nbsp; 
Result:=<SPAN style="COLOR: rgb(0,0,240)">Описание 
плагина</SPAN>+sLineBreak+<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<SPAN style="COLOR: rgb(0,0,240)">'У вас старая версия программы! Плагин не 
сможет корректно с ней работать!'</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">else</SPAN><BR>&nbsp; &nbsp; 
Result:=<SPAN style="COLOR: rgb(0,0,240)">описание плагина'</SPAN>;<BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">end</SPAN>;<BR><BR><SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// Обязательно вызываемая 
функция.</SPAN><BR><SPAN style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// 
Получает структуру с ссылками на все функции основной программы,</SPAN><BR><SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// которые могут вызываться из 
плагина.</SPAN><BR><SPAN style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// Если 
вернёт False то плагин выгружается.</SPAN><BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">function</SPAN> SetStruct<SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">const</SPAN> struct: 
PPluginStruct<SPAN style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
style="COLOR: rgb(0,0,0)">Boolean</SPAN>; stdcall;<BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">begin</SPAN><BR>&nbsp; ps := 
struct^;<BR>&nbsp; Result:=<SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">True</SPAN>;<BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">end</SPAN>;<BR><BR><BR><BR><SPAN 
style="FONT-STYLE: italic; COLOR: rgb(0,128,0)">// экспортируем используемые 
программой функции</SPAN><BR>exports<BR>&nbsp; GetPluginInfo,<BR>&nbsp; 
SetStruct;<BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">begin</SPAN><BR><SPAN 
style="COLOR: rgb(0,0,128); FONT-WEIGHT: bold">end</SPAN>.</FONT> 
<P><STRONG></STRONG>&nbsp;</P>
<P>Класс&nbsp;TPluginStruct экземпляр которого передается плагину можно глянуть 
в разделе "Содержимое uSharedStructs"<BR>Все&nbsp;ее&nbsp;функции/процедуры в 
ней аналогичны тем что используются в скриптах.</P></BODY>
</html>
