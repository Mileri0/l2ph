<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>plugin_demo2.dpr; Добавление своих функций</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">

</head>

<BODY>
<P><FONT face=Arial size=2>&nbsp;&nbsp;<FONT size=2><FONT 
face=Arial>&nbsp;</FONT><FONT size=5><FONT face=Arial 
color=#003f7d><STRONG>plugin_demo.dpr; добавление своих 
функций.</STRONG></FONT><FONT size=3> 
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial></FONT>
<P><FONT face=Arial>
<P>
<P>
<P>
<P>
<HR>

<P><STRONG>Для версии 3.5.1.100</STRONG></FONT></FONT></FONT></FONT></FONT></P>
<P><FONT size=2>library plugin_demo2;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{$define RELEASE}</SPAN> <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// для совместимости с релизом 
пакетхака, при дебуге можно закоментировать</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">uses</SPAN><BR>&nbsp; FastMM4 
<SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> <SPAN 
style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4.pas'</SPAN>,<BR>&nbsp; 
FastMM4Messages <SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> 
<SPAN 
style="COLOR: rgb(0,0,240)">'..\fastmm\FastMM4Messages.pas'</SPAN>,<BR>&nbsp; 
windows,<BR>&nbsp; usharedstructs <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">in</SPAN> <SPAN 
style="COLOR: rgb(0,0,240)">'..\units\usharedstructs.pas'</SPAN>;<BR><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">var</SPAN>&nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{version}</SPAN> <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{revision}</SPAN><BR>&nbsp; 
min_ver_a: array[<SPAN style="COLOR: rgb(0,0,240)">0</SPAN>..<SPAN 
style="COLOR: rgb(0,0,240)">3</SPAN>] <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">of</SPAN> <SPAN 
style="COLOR: rgb(0,0,0)">Byte</SPAN> = <SPAN style="COLOR: rgb(0,0,0)">(</SPAN> 
<SPAN style="COLOR: rgb(0,0,240)">3</SPAN>,<SPAN 
style="COLOR: rgb(0,0,240)">5</SPAN>,<SPAN 
style="COLOR: rgb(0,0,240)">1</SPAN>,&nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,0,240)">98</SPAN>&nbsp; &nbsp;<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; min_ver: <SPAN 
style="COLOR: rgb(0,0,0)">Integer</SPAN> absolute min_ver_a; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// минимальная поддерживаемая 
версия программы</SPAN><BR>&nbsp; ps: TPluginStruct; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// структура передаваемая в 
плагин</SPAN><BR><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// 
Обязательно вызываемая функция.</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Должна вернуть описание 
плагина,</SPAN><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// 
заодно может проверить версию программы</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">function</SPAN> 
GetPluginInfo<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> ver: <SPAN 
style="COLOR: rgb(0,0,0)">Integer</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
style="COLOR: rgb(0,0,0)">PChar</SPAN>; stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">if</SPAN> ver&lt;min_ver <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">then</SPAN><BR>&nbsp; &nbsp; 
Result:=<SPAN style="COLOR: rgb(0,0,240)">'Демонстрационный Plugin к программе 
l2phx'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,0,240)">'Для версий 3.5.1.98+'</SPAN>+sLineBreak+<BR>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN style="COLOR: rgb(0,0,240)">'У вас 
старая версия программы! Плагин не сможет корректно с ней 
работать!'</SPAN><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">else</SPAN><BR>&nbsp; &nbsp; 
Result:=<SPAN style="COLOR: rgb(0,0,240)">'Демонстрационный Plugin к программе 
l2phx'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,0,240)">'Для версий 3.5.1.98+'</SPAN>+sLineBreak+<BR>&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN style="COLOR: rgb(0,0,240)">'Показывает 
каким образом можно добавить свою функцию/процедуру в 
ПХ'</SPAN>+sLineBreak+<BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,0,240)">''</SPAN>;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Обязательно вызываемая 
функция.</SPAN><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// 
Получает структуру с ссылками на все функции основной программы,</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// которые могут вызываться из 
плагина.</SPAN><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Если 
вернёт False то плагин выгружается.</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">function</SPAN> SetStruct<SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> struct: 
PPluginStruct<SPAN style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
style="COLOR: rgb(0,0,0)">Boolean</SPAN>; stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; ps := 
TPluginStruct<SPAN style="COLOR: rgb(0,0,0)">(</SPAN>struct^<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; Result:=<SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">True</SPAN>;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при установки 
соединения (cnt) с клиентом (withServer=False) </SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// или сервером 
(withServer=True)</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">procedure</SPAN> OnConnect<SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> cnt: <SPAN 
style="COLOR: rgb(0,0,0)">Cardinal</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// номер 
соединения</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; <SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> 
withServer: <SPAN style="COLOR: rgb(0,0,0)">Boolean</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>; stdcall; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// с сервером?</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при разрыве 
соединения (cnt) с клиентом (withServer=False)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// или сервером 
(withServer=True)</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">procedure</SPAN> 
OnDisconnect<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> cnt: <SPAN 
style="COLOR: rgb(0,0,0)">Cardinal</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// номер 
соединения</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;<SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> withServer: <SPAN 
style="COLOR: rgb(0,0,0)">Boolean</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>; stdcall; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// с сервером?</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при выгрузке 
плагине</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">procedure</SPAN> OnFree; 
stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при загрузке 
плагине</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">procedure</SPAN> OnLoad; 
stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при вызове 
скриптовой функции обьявленной в RefreshPrecompile</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">function</SPAN> OnCallMethod<SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> MethodName: <SPAN 
style="COLOR: rgb(0,0,0)">String</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// имя функции в верхнем 
регистре</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">var</SPAN> Params, <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// параметры 
функции</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; FuncResult: <SPAN style="COLOR: rgb(0,0,0)">Variant</SPAN> <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// результат 
функции</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>: <SPAN 
style="COLOR: rgb(0,0,0)">Boolean</SPAN>; stdcall; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// если вернёт True то 
дальнейшая</SPAN><BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// обработка функции 
прекратиться</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; 
Result:=<SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">False</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// передаём обработку функции 
программе</SPAN><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">if</SPAN> MethodName=<SPAN 
style="COLOR: rgb(0,0,240)">'PI'</SPAN> <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">then</SPAN> <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; &nbsp; 
Result:=<SPAN style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">True</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// запрещаем дальнейшую 
обработку функции в программе</SPAN><BR>&nbsp; &nbsp; FuncResult:=<SPAN 
style="COLOR: rgb(0,0,0)">Pi</SPAN>;<BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">if</SPAN> MethodName=<SPAN 
style="COLOR: rgb(0,0,240)">'SHOW_MY_MESSAGE'</SPAN> <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">then</SPAN> <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; &nbsp; 
MessageBox<SPAN style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="COLOR: rgb(0,0,240)">0</SPAN>,<SPAN 
style="COLOR: rgb(0,0,0)">pchar</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">string</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN>Params[<SPAN 
style="COLOR: rgb(0,0,240)">0</SPAN>]<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN><SPAN style="COLOR: rgb(0,0,0)">)</SPAN>,<SPAN 
style="COLOR: rgb(0,0,240)">''</SPAN>,MB_OK<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; &nbsp; Result:=<SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">True</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// запрещаем дальнейшую 
обработку функции в программе</SPAN><BR>&nbsp; &nbsp; FuncResult:=<SPAN 
style="COLOR: rgb(0,0,240)">0</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//какой результат ? это 
процедура.</SPAN><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается после иницализации 
плагина, позволяет добавлять свои функции в редактор / скриптовый 
движек</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">Procedure</SPAN> 
OnRefreshPrecompile; stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; ps.<SPAN 
style="COLOR: rgb(0,0,0)">UserFuncs</SPAN>.<SPAN 
style="COLOR: rgb(0,0,0)">Add</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN style="COLOR: rgb(0,0,240)">'function 
Pi:Extended'</SPAN><SPAN style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; ps.<SPAN 
style="COLOR: rgb(0,0,0)">UserFuncs</SPAN>.<SPAN 
style="COLOR: rgb(0,0,0)">Add</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN style="COLOR: rgb(0,0,240)">'procedure 
Show_my_message(msg:string)'</SPAN><SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>;<BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//а вот теперь 
внимание</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//ps.UserFuncs.Add('procedure 
Show_my_message(%s)');</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//%s говорит о том что функция в 
своих параметрах будет передавать изначально</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//екземпляр класса 
TfsScript</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//%s должен быть последней либо 
единственным параметром</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//к примеру обьявление некоторых 
функций в пх</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//'procedure 
SetName(Name:string;%s)'</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//'procedure 
Disconnect(%s)'</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//'procedure 
WriteS(v:string;%s)'</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//обратите внимание на ";" перед 
параметром, он есть при условии что %s не единственный параметр 
функции</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//что это дает:</SPAN><BR>&nbsp; 
<SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//возможность выдергивать 
переменные с фастскрипта.</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//как это делаеться в 
пх:</SPAN><BR>&nbsp; </FONT><FONT size=2><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">{<BR>&nbsp; if sMethodName = 
'DISCONNECT' then<BR>&nbsp; begin<BR>&nbsp; &nbsp; 
ConId:=TfsScript(Integer(Params[0])).Variables['ConnectID'];<BR>&nbsp; &nbsp; 
DoDisconnect(ConId);<BR>&nbsp; end<BR><BR>&nbsp; либо<BR><BR>&nbsp; if 
sMethodName = 'SETNAME' then<BR>&nbsp; begin<BR>&nbsp; &nbsp; 
buf:=TfsScript(Integer(Params[1])).Variables['buf'];<BR>&nbsp; &nbsp; 
ConId:=TfsScript(Integer(Params[1])).Variables['ConnectID'];<BR>&nbsp; &nbsp; 
SetConName(ConId, String(Params[0]));<BR>&nbsp; end&nbsp; <BR>&nbsp; 
}</SPAN><BR>&nbsp; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">//TfsScript(Integer(Params[0])) 
- екземпляр TfsScript</SPAN><BR><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Необязательно вызываемая 
функция. (может отсутствовать в плагине)</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// Вызывается при приходе 
пакета, параметры:</SPAN><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// cnt - номер 
соединения</SPAN><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// 
fromServer - если пакет от сервера равна True, если от клиента то 
False</SPAN><BR><SPAN style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// pck - 
собственно пакет (в виде массива)</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">procedure</SPAN> OnPacket<SPAN 
style="COLOR: rgb(0,0,0)">(</SPAN><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> cnt: <SPAN 
style="COLOR: rgb(0,0,0)">Cardinal</SPAN>; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">const</SPAN> fromServer: <SPAN 
style="COLOR: rgb(0,0,0)">Boolean</SPAN>; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">var</SPAN> pck: TPacket<SPAN 
style="COLOR: rgb(0,0,0)">)</SPAN>; stdcall;<BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR>&nbsp; <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">if</SPAN> pck.<SPAN 
style="COLOR: rgb(0,0,0)">size</SPAN>&lt;<SPAN 
style="COLOR: rgb(0,0,240)">3</SPAN> <SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">then</SPAN> <SPAN 
style="COLOR: rgb(0,0,0)">exit</SPAN>; <SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// на случай если предыдущие 
плагины обнулили пакет</SPAN><BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>;<BR><BR><SPAN 
style="COLOR: rgb(0,128,0); FONT-STYLE: italic">// экспортируем используемые 
программой функции</SPAN><BR>exports<BR>&nbsp; GetPluginInfo,<BR>&nbsp; 
SetStruct,<BR>&nbsp; OnPacket,<BR>&nbsp; OnConnect,<BR>&nbsp; 
OnDisconnect,<BR>&nbsp; OnLoad,<BR>&nbsp; OnFree,<BR>&nbsp; 
OnCallMethod,<BR>&nbsp; OnRefreshPrecompile;<BR><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">begin</SPAN><BR><SPAN 
style="FONT-WEIGHT: bold; COLOR: rgb(0,0,128)">end</SPAN>.</FONT></P></BODY>
</html>
